GUIA DE PROGRAMACIÓ

APUNTES ANTES DE ACABAR
-> PROBAR EN VARIOS SISTEMAS
-> AÑADIR COMPROBACIÓN DEL SISTEMA OPERATIVO ?

ÍNDEX

CODI
0. INICIALITZACIÓ SCRIPT
1. VARIABLES
2. COMPROVACIONS PREVIES
3. CREACIÓ DE FITXERS NECESSARIS
4. MONITORITZACIÓ DE PAQUETS
5. TRACTAMENT D'ATACS
6. MAQUETACIÓ DE DADES

INFORMACIÓ SCRIPT
7. NECESSITATS DEL SCRIPT
8. PROVES DE VALIDACIÓ
9. ESCENARIS DE FALLIDA
10. PUNTS DE MILLORA
11. CONCLUSIONS GENERALS


####### 0. INICIALITZACIÓ SCRIPT #######
Primer i abans de començar a explicar el funcionament, trobem la capçalera de l'script, alla trobarem dues 
linies importants: 

#!/bin/bash --> Amb aquesta intrucció forçarem al sistema a utilitzar la sheel de bash, imprescindible ja
que està programat en bash.

#!utf-8 --> Amb aquesta instrucció introduirem el format utf-8 que ens evitarà errors de format en diferents
casos com els accents.

####### 1. VARIABLES #######
























TCP DUMP 
FLAGS
-i elegir interficie que capturar
-c capturamos un numero concreto de paquetes
-A paquetes en formato ASCII
-w elegir un fichero de tipo ".pcap" que guarda los resultados  (tcpdump -w eth0.pcap -i eth0)
-r para analizar el fichero generado .pcap (tcpdump -r eth0.pcap)
-n analizar IPaddr, mantiene las ip en los resultados y no las traduce a nombres
-->Añadimos en protcolo al final(creo que no hace falta que sea el final) para analizar solo los paquetes con 
ese protcolo. 
port XX para monitorizar un puerto especifico.
src IPaddr para monitorizar paquetes de una ip de origen
dst IPaddr para monitorizar paquetes de una ip de destino
-v verbose output
-vv more verbose output

-x : When parsing and printing, in addition to printing the headers of each packet, print the data of each packet.
-X : hen parsing and printing, in addition to printing the headers of each packet, print the data of each packet (minus its link level header) in hex and ASCII. This is very handy for analysing new protocols.
-s 1500: Snarf snaplen bytes of data from each packet rather than the default of 68. This is useful to see lots of information.


PARA TCP
 --> tcpdump -i enp0s3 'tcp[13]=2 && port 22'

tcpdump -nn -l -q -i enp0s3 'tcp[13]=2 && port 22' 2>/dev/null > /root/test.log 

test connections --> nc   
test tcp connections --> nc -z -v ip port

guardar pid del tcpdump

PARA UDP
usual upd ports: 161 162

--> tcpdump -nn -i enp0s3 udp port XX

PARA ICMP 
-->  tcpdump -l -nni enp0s3 'not src 192.168.0.26 && icmp'


TAILS 
TIEMPO --> awk '/./{time=$1} END{print time}' test.log
IP --> awk '/./{ip=$3} END{print ip}' test.log | cut -d '.' -f1,2,3,4
PUERTO --> awk '/./{port=$3} END{print port}' test.log | cut -d '.' -f5

